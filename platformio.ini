; Autonomous Race Buoy — PlatformIO configuration
; VS Code + PlatformIO IDE
;
; Build:          pio run -e lora_tx
; Upload:         pio run -e lora_tx -t upload
; Serial monitor: pio device monitor -e lora_tx
;
; Each test sketch lives in its own subdirectory under testing/ as main.cpp.
; build_src_filter per environment selects only that sketch for compilation.

; ---------------------------------------------------------------------------
; [env] — defaults inherited by every [env:xxx] section
; ---------------------------------------------------------------------------
[env]
platform  = espressif32
board     = esp32-s3-devkitc-1
framework = arduino

; -I${PROJECT_DIR} lets sketches use #include "common/config.h" resolved
; from the project root, regardless of which subdirectory they live in.
build_flags =
    -I${PROJECT_DIR}
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1

; ---------------------------------------------------------------------------
[platformio]
; src_dir covers all test sketches; build_src_filter per env selects one.
src_dir      = testing
default_envs = lora_tx

; ---------------------------------------------------------------------------
; Test environments
; ---------------------------------------------------------------------------

[env:gps_test]
; GPS + OLED display test — testing/gps_test_display/main.cpp
; Hardware: ESP32-S3-DevKitC-1 + BE-880 GPS (GPIO17/18) + SSD1306 (GPIO8/9)
build_src_filter = -<*> +<gps_test_display/main.cpp>
monitor_speed = 115200
monitor_rts   = 0
monitor_dtr   = 0
lib_deps =
    mikalhart/TinyGPSPlus
    adafruit/Adafruit SSD1306
    adafruit/Adafruit GFX Library

[env:lora_tx]
; LoRa transmitter test — testing/lora_test_tx/main.cpp
; Hardware: ESP32-S3-DevKitC-1 + RFM95W (SPI: GPIO11/13/12/10, RST=14, IRQ=21)
build_src_filter = -<*> +<lora_test_tx/main.cpp>
monitor_speed = 115200
lib_deps =
    mikem/RadioHead

[env:lora_rx]
; LoRa receiver test — testing/lora_test_rx/main.cpp
; Hardware: ESP32-S3-DevKitC-1 + RFM95W (same wiring as lora_tx)
build_src_filter = -<*> +<lora_test_rx/main.cpp>
monitor_speed = 115200
lib_deps =
    mikem/RadioHead

; ---------------------------------------------------------------------------
; Future environments (create testing/<name>/main.cpp, add env here)
; ---------------------------------------------------------------------------

; [env:wind_sensor]
; build_src_filter = -<*> +<wind_sensor_test/main.cpp>
; monitor_speed    = 115200
